# JT808-Vertx é‡æ„å®æ–½è®¡åˆ’

## ğŸ“‹ é‡æ„æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†JT808-Vertxé¡¹ç›®çš„é‡æ„å®æ–½æ–¹æ¡ˆï¼ŒåŸºäºä»£ç è´¨é‡åˆ†æå’Œæ¶æ„ä¼˜åŒ–éœ€æ±‚ï¼Œåˆ†é˜¶æ®µè¿›è¡Œç³»ç»Ÿæ€§é‡æ„ã€‚

### ğŸ¯ é‡æ„ç›®æ ‡

- **æå‡ä»£ç è´¨é‡**ï¼šæ¶ˆé™¤ä»£ç é‡å¤ï¼Œä¼˜åŒ–ç±»è®¾è®¡
- **å¢å¼ºå¯ç»´æŠ¤æ€§**ï¼šèŒè´£åˆ†ç¦»ï¼Œé™ä½è€¦åˆåº¦
- **æé«˜æ€§èƒ½**ï¼šä¼˜åŒ–å¤„ç†æµç¨‹ï¼Œå‡å°‘èµ„æºæ¶ˆè€—
- **æ”¹å–„æµ‹è¯•æ€§**ï¼šç»Ÿä¸€æµ‹è¯•æ¨¡å¼ï¼Œæé«˜è¦†ç›–ç‡
- **å¢å¼ºæ‰©å±•æ€§**ï¼šæ”¯æŒæ–°åè®®ç‰ˆæœ¬å’ŒåŠŸèƒ½æ‰©å±•

## ğŸ—“ï¸ é‡æ„é˜¶æ®µè§„åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**é¢„è®¡æ—¶é—´ï¼š3-4å¤©**

#### 1.1 æ¶ˆæ¯å·¥å‚æ¨¡å¼ä¼˜åŒ–
- **æ–‡ä»¶**ï¼š`JT808MessageFactory.java`
- **ç›®æ ‡**ï¼šæ‹†åˆ†è¿‡é•¿çš„åˆå§‹åŒ–æ–¹æ³•ï¼ŒæŒ‰æ¶ˆæ¯ç±»å‹åˆ†ç»„
- **å…·ä½“ä»»åŠ¡**ï¼š
  - å°† `initMessageCreators()` æ‹†åˆ†ä¸º3ä¸ªæ–¹æ³•
  - åˆ›å»ºæ¶ˆæ¯ç±»å‹å¸¸é‡ç±»
  - ä¼˜åŒ–æ¶ˆæ¯æ³¨å†Œé€»è¾‘

#### 1.2 æ¶ˆæ¯å¤„ç†å™¨é‡æ„ âœ… å·²å®Œæˆ
- **æ–‡ä»¶**ï¼š`JT808MessageHandler.java`
- **ç›®æ ‡**ï¼šæŒ‰èŒè´£æ‹†åˆ†å¤§ç±»ï¼Œå®ç°å•ä¸€èŒè´£åŸåˆ™
- **å®Œæˆæ—¶é—´**ï¼š2025-07-20
- **å…·ä½“ä»»åŠ¡**ï¼š
  - âœ… åˆ›å»º `MessageRouter` ç±»
  - âœ… åˆ›å»º `SessionHandler` ç±»
  - âœ… åˆ›å»º `PerformanceMonitor` ç±»
  - âœ… åˆ›å»º `MessageValidator` ç±»
  - âœ… é‡æ„åŸæœ‰å¤„ç†é€»è¾‘
  - âœ… åˆ›å»º `ProcessorManager` ç»Ÿä¸€ç®¡ç†å¤„ç†å™¨
  - âœ… æ”¯æŒ23ä¸ªæ¶ˆæ¯å¤„ç†å™¨

#### 1.3 ç¼–è§£ç å™¨ä¼˜åŒ–
- **æ–‡ä»¶**ï¼š`JT808Decoder.java`
- **ç›®æ ‡**ï¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼æ›¿ä»£ç¡¬ç¼–ç 
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»ºæ¶ˆæ¯åˆ›å»ºç­–ç•¥æ¥å£
  - å®ç°æ¶ˆæ¯åˆ›å»ºå™¨æ³¨å†Œè¡¨
  - é‡æ„ `createMessage()` æ–¹æ³•

### ç¬¬äºŒé˜¶æ®µï¼šä»£ç é‡å¤æ¶ˆé™¤ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**é¢„è®¡æ—¶é—´ï¼š2-3å¤©**

#### 2.1 æµ‹è¯•ä»£ç é‡æ„
- **ç›®æ ‡**ï¼šåˆ›å»ºç»Ÿä¸€çš„æµ‹è¯•åŸºç±»å’Œå·¥å…·
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»º `BaseMessageTest` æŠ½è±¡åŸºç±»
  - åˆ›å»º `TestDataFactory` æµ‹è¯•æ•°æ®å·¥å‚
  - åˆ›å»º `AssertionUtils` æ–­è¨€å·¥å…·ç±»
  - é‡æ„ç°æœ‰æµ‹è¯•ç±»

#### 2.2 BCDç¼–ç è§£ç ç»Ÿä¸€
- **æ–‡ä»¶**ï¼š`ByteUtils.java`
- **ç›®æ ‡**ï¼šç»Ÿä¸€æ—¶é—´ç¼–è§£ç é€»è¾‘
- **å…·ä½“ä»»åŠ¡**ï¼š
  - æ·»åŠ  `encodeBcdTime()` æ–¹æ³•
  - æ·»åŠ  `decodeBcdTime()` æ–¹æ³•
  - é‡æ„ä½¿ç”¨BCDæ—¶é—´çš„æ¶ˆæ¯ç±»

#### 2.3 å±æ€§ä½æ“ä½œç»Ÿä¸€
- **ç›®æ ‡**ï¼šåˆ›å»ºç»Ÿä¸€çš„ä½æ ‡å¿—æ“ä½œå·¥å…·
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»º `AttributeUtils` å·¥å…·ç±»
  - å®ç°é€šç”¨ä½æ“ä½œæ–¹æ³•
  - é‡æ„å¤æ‚æ¶ˆæ¯ç±»çš„å±æ€§å¤„ç†

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
**é¢„è®¡æ—¶é—´ï¼š2-3å¤©**

#### 3.1 å¯¹è±¡æ± åŒ–å®ç°
- **ç›®æ ‡**ï¼šå‡å°‘é¢‘ç¹å¯¹è±¡åˆ›å»ºçš„GCå‹åŠ›
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»º `MessageObjectPool` ç±»
  - å®ç°æ¶ˆæ¯å¯¹è±¡å¤ç”¨æœºåˆ¶
  - é›†æˆåˆ°æ¶ˆæ¯å·¥å‚ä¸­

#### 3.2 ç¼“å­˜ä¼˜åŒ–
- **ç›®æ ‡**ï¼šç»Ÿä¸€ç¼“å­˜ç®¡ç†
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»º `CacheManager` ç±»
  - å®ç°åˆ†å±‚ç¼“å­˜ç­–ç•¥
  - ä¼˜åŒ–æ¶ˆæ¯å¤„ç†å™¨ç¼“å­˜é€»è¾‘

#### 3.3 å¼‚æ­¥å¤„ç†ä¼˜åŒ–
- **ç›®æ ‡**ï¼šé¿å…é˜»å¡Event Loop
- **å…·ä½“ä»»åŠ¡**ï¼š
  - è¯†åˆ«åŒæ­¥æ“ä½œç‚¹
  - å®ç°å¼‚æ­¥ç¼–è§£ç 
  - ä¼˜åŒ–I/Oæ“ä½œ

### ç¬¬å››é˜¶æ®µï¼šä»£ç è´¨é‡æå‡ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
**é¢„è®¡æ—¶é—´ï¼š2å¤©**

#### 4.1 å¼‚å¸¸å¤„ç†æ ‡å‡†åŒ–
- **ç›®æ ‡**ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†ç­–ç•¥
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹
  - å®ç°å…¨å±€å¼‚å¸¸å¤„ç†å™¨
  - æ ‡å‡†åŒ–é”™è¯¯ç å®šä¹‰

#### 4.2 å¸¸é‡ç®¡ç†ä¼˜åŒ–
- **ç›®æ ‡**ï¼šé›†ä¸­ç®¡ç†åè®®å¸¸é‡
- **å…·ä½“ä»»åŠ¡**ï¼š
  - åˆ›å»º `ProtocolConstants` ç±»
  - æ•´ç†åˆ†æ•£çš„é­”æ³•æ•°å­—
  - å®ç°å¸¸é‡åˆ†ç»„ç®¡ç†

#### 4.3 æ—¥å¿—æ ‡å‡†åŒ–
- **ç›®æ ‡**ï¼šå®ç°ç»“æ„åŒ–æ—¥å¿—
- **å…·ä½“ä»»åŠ¡**ï¼š
  - å®šä¹‰æ—¥å¿—æ ¼å¼æ ‡å‡†
  - åˆ›å»ºæ—¥å¿—å·¥å…·ç±»
  - ç»Ÿä¸€æ—¥å¿—çº§åˆ«ä½¿ç”¨

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
jt808-protocol/src/main/java/com/jt808/protocol/
â”œâ”€â”€ processor/
â”‚   â”œâ”€â”€ MessageProcessor.java          # æ¶ˆæ¯å¤„ç†å™¨æ¥å£
â”‚   â”œâ”€â”€ MessageProcessorChain.java     # å¤„ç†å™¨é“¾
â”‚   â”œâ”€â”€ ProcessContext.java            # å¤„ç†ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ ProcessResult.java             # å¤„ç†ç»“æœ
â”‚   â””â”€â”€ impl/
â”‚       â”œâ”€â”€ MessageRouter.java         # æ¶ˆæ¯è·¯ç”±å™¨
â”‚       â”œâ”€â”€ SessionHandler.java        # ä¼šè¯å¤„ç†å™¨
â”‚       â”œâ”€â”€ PerformanceMonitor.java    # æ€§èƒ½ç›‘æ§å™¨
â”‚       â””â”€â”€ MessageValidator.java      # æ¶ˆæ¯éªŒè¯å™¨
â”œâ”€â”€ strategy/
â”‚   â”œâ”€â”€ MessageCreationStrategy.java   # æ¶ˆæ¯åˆ›å»ºç­–ç•¥
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ DefaultCreationStrategy.java
â”œâ”€â”€ pool/
â”‚   â”œâ”€â”€ MessageObjectPool.java         # æ¶ˆæ¯å¯¹è±¡æ± 
â”‚   â””â”€â”€ PooledMessage.java             # æ± åŒ–æ¶ˆæ¯æ¥å£
â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ CacheManager.java              # ç¼“å­˜ç®¡ç†å™¨
â”‚   â””â”€â”€ CacheConfig.java               # ç¼“å­˜é…ç½®
â””â”€â”€ constants/
    â”œâ”€â”€ ProtocolConstants.java          # åè®®å¸¸é‡
    â”œâ”€â”€ MessageTypes.java              # æ¶ˆæ¯ç±»å‹å¸¸é‡
    â””â”€â”€ ErrorCodes.java                # é”™è¯¯ç å¸¸é‡

jt808-common/src/main/java/com/jt808/common/
â”œâ”€â”€ util/
â”‚   â”œâ”€â”€ AttributeUtils.java            # å±æ€§ä½æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ TimeUtils.java                 # æ—¶é—´å¤„ç†å·¥å…·
â”‚   â””â”€â”€ LogUtils.java                  # æ—¥å¿—å·¥å…·
â”œâ”€â”€ exception/
â”‚   â”œâ”€â”€ MessageValidationException.java # æ¶ˆæ¯éªŒè¯å¼‚å¸¸
â”‚   â”œâ”€â”€ ProcessingException.java       # å¤„ç†å¼‚å¸¸
â”‚   â””â”€â”€ ConfigurationException.java    # é…ç½®å¼‚å¸¸
â””â”€â”€ config/
    â””â”€â”€ ProtocolConfig.java             # åè®®é…ç½®

jt808-protocol/src/test/java/com/jt808/protocol/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ BaseMessageTest.java           # æµ‹è¯•åŸºç±»
â”‚   â”œâ”€â”€ TestDataFactory.java           # æµ‹è¯•æ•°æ®å·¥å‚
â”‚   â””â”€â”€ AssertionUtils.java            # æ–­è¨€å·¥å…·
â””â”€â”€ util/
    â””â”€â”€ TestUtils.java                  # æµ‹è¯•å·¥å…·ç±»
```

## ğŸ”§ å…·ä½“å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šåˆ›å»ºåŸºç¡€æ¥å£å’ŒæŠ½è±¡ç±»

1. **åˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨æ¥å£**
   ```java
   public interface MessageProcessor<T extends JT808Message> {
       CompletableFuture<ProcessResult> process(T message, ProcessContext context);
       boolean supports(Class<? extends JT808Message> messageType);
       int getPriority();
   }
   ```

2. **åˆ›å»ºæµ‹è¯•åŸºç±»**
   ```java
   public abstract class BaseMessageTest<T extends JT808Message> {
       protected T message;
       protected JT808MessageFactory factory;
       
       @BeforeEach
       void setUp() {
           message = createMessage();
           factory = JT808MessageFactory.getInstance();
       }
       
       protected abstract T createMessage();
       
       // é€šç”¨æµ‹è¯•æ–¹æ³•
       @Test
       void testMessageId() {
           assertNotNull(message.getMessageId());
       }
   }
   ```

### æ­¥éª¤2ï¼šé‡æ„æ¶ˆæ¯å·¥å‚

1. **æ‹†åˆ†åˆå§‹åŒ–æ–¹æ³•**
   ```java
   private void initMessageCreators() {
       initTerminalMessages();
       initPlatformMessages();
       initExtensionMessages();
   }
   
   private void initTerminalMessages() {
       // 0x0xxx ç»ˆç«¯æ¶ˆæ¯
       messageCreators.put(0x0001, T0001TerminalCommonResponse::new);
       // ...
   }
   ```

2. **åˆ›å»ºæ¶ˆæ¯ç±»å‹å¸¸é‡**
   ```java
   public final class MessageTypes {
       // ç»ˆç«¯æ¶ˆæ¯
       public static final int TERMINAL_COMMON_RESPONSE = 0x0001;
       public static final int TERMINAL_HEARTBEAT = 0x0002;
       // ...
   }
   ```

### æ­¥éª¤3ï¼šé‡æ„æ¶ˆæ¯å¤„ç†å™¨

1. **åˆ›å»ºæ¶ˆæ¯è·¯ç”±å™¨**
   ```java
   public class MessageRouter {
       private final Map<Integer, MessageProcessor<?>> processors;
       
       public CompletableFuture<ProcessResult> route(JT808Message message, ProcessContext context) {
           // è·¯ç”±é€»è¾‘
       }
   }
   ```

2. **åˆ›å»ºä¼šè¯å¤„ç†å™¨**
   ```java
   public class SessionHandler {
       public void updateSession(Session session, JT808Message message) {
           // ä¼šè¯æ›´æ–°é€»è¾‘
       }
   }
   ```

### æ­¥éª¤4ï¼šåˆ›å»ºå·¥å…·ç±»

1. **å±æ€§ä½æ“ä½œå·¥å…·**
   ```java
   public final class AttributeUtils {
       public static boolean hasAttribute(int value, int attribute) {
           return (value & attribute) != 0;
       }
       
       public static int addAttribute(int value, int attribute) {
           return value | attribute;
       }
   }
   ```

2. **æ—¶é—´å¤„ç†å·¥å…·**
   ```java
   public final class TimeUtils {
       public static Buffer encodeBcdTime(LocalDateTime time) {
           // BCDæ—¶é—´ç¼–ç 
       }
       
       public static LocalDateTime decodeBcdTime(Buffer buffer, int offset) {
           // BCDæ—¶é—´è§£ç 
       }
   }
   ```

## âœ… éªŒæ”¶æ ‡å‡†

### ä»£ç è´¨é‡æŒ‡æ ‡
- [ ] å•ä¸ªç±»è¡Œæ•°ä¸è¶…è¿‡500è¡Œ
- [ ] å•ä¸ªæ–¹æ³•è¡Œæ•°ä¸è¶…è¿‡50è¡Œ
- [ ] åœˆå¤æ‚åº¦ä¸è¶…è¿‡10
- [ ] ä»£ç é‡å¤ç‡ä½äº5%

### æ€§èƒ½æŒ‡æ ‡
- [ ] æ¶ˆæ¯å¤„ç†å»¶è¿Ÿä¸è¶…è¿‡10ms
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–20%ä»¥ä¸Š
- [ ] GCé¢‘ç‡é™ä½30%ä»¥ä¸Š

### æµ‹è¯•æŒ‡æ ‡
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°85%ä»¥ä¸Š
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ç‡100%
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### åŠŸèƒ½æŒ‡æ ‡
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ–°å¢åŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œ
- [ ] å‘åå…¼å®¹æ€§ä¿æŒ

## ğŸš¨ é£é™©æ§åˆ¶

### æŠ€æœ¯é£é™©
- **é£é™©**ï¼šé‡æ„è¿‡ç¨‹ä¸­å¼•å…¥æ–°bug
- **æ§åˆ¶**ï¼šåˆ†é˜¶æ®µé‡æ„ï¼Œæ¯é˜¶æ®µå®Œæˆåè¿›è¡Œå®Œæ•´æµ‹è¯•

### è¿›åº¦é£é™©
- **é£é™©**ï¼šé‡æ„æ—¶é—´è¶…å‡ºé¢„æœŸ
- **æ§åˆ¶**ï¼šè®¾ç½®é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹ï¼ŒåŠæ—¶è°ƒæ•´è®¡åˆ’

### å…¼å®¹æ€§é£é™©
- **é£é™©**ï¼šç ´åç°æœ‰APIå…¼å®¹æ€§
- **æ§åˆ¶**ï¼šä¿æŒå…¬å…±æ¥å£ä¸å˜ï¼Œå†…éƒ¨å®ç°é‡æ„

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

| é˜¶æ®µ | ä»»åŠ¡ | çŠ¶æ€ | å¼€å§‹æ—¶é—´ | å®Œæˆæ—¶é—´ | è´Ÿè´£äºº |
|------|------|------|----------|----------|--------|
| ç¬¬ä¸€é˜¶æ®µ | æ¶ˆæ¯å·¥å‚ä¼˜åŒ– | âœ… å·²å®Œæˆ | 2025-07-20 | 2025-07-20 | AIåŠ©ç† |
| ç¬¬ä¸€é˜¶æ®µ | æ¶ˆæ¯å¤„ç†å™¨é‡æ„ | âœ… å·²å®Œæˆ | 2025-07-20 | 2025-07-20 | AIåŠ©ç† |
| ç¬¬ä¸€é˜¶æ®µ | ç¼–è§£ç å™¨ä¼˜åŒ– | å¾…å¼€å§‹ | | | |
| ç¬¬äºŒé˜¶æ®µ | æµ‹è¯•ä»£ç é‡æ„ | å¾…å¼€å§‹ | | | |
| ç¬¬äºŒé˜¶æ®µ | BCDç¼–ç ç»Ÿä¸€ | å¾…å¼€å§‹ | | | |
| ç¬¬äºŒé˜¶æ®µ | å±æ€§æ“ä½œç»Ÿä¸€ | å¾…å¼€å§‹ | | | |
| ç¬¬ä¸‰é˜¶æ®µ | å¯¹è±¡æ± åŒ– | å¾…å¼€å§‹ | | | |
| ç¬¬ä¸‰é˜¶æ®µ | ç¼“å­˜ä¼˜åŒ– | å¾…å¼€å§‹ | | | |
| ç¬¬ä¸‰é˜¶æ®µ | å¼‚æ­¥ä¼˜åŒ– | å¾…å¼€å§‹ | | | |
| ç¬¬å››é˜¶æ®µ | å¼‚å¸¸å¤„ç† | å¾…å¼€å§‹ | | | |
| ç¬¬å››é˜¶æ®µ | å¸¸é‡ç®¡ç† | å¾…å¼€å§‹ | | | |
| ç¬¬å››é˜¶æ®µ | æ—¥å¿—æ ‡å‡†åŒ– | å¾…å¼€å§‹ | | | |

## ğŸ“ æ€»ç»“

æœ¬é‡æ„è®¡åˆ’æ—¨åœ¨ç³»ç»Ÿæ€§åœ°æå‡JT808-Vertxé¡¹ç›®çš„ä»£ç è´¨é‡ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚é€šè¿‡åˆ†é˜¶æ®µå®æ–½ï¼Œç¡®ä¿é‡æ„è¿‡ç¨‹çš„å¯æ§æ€§å’Œå®‰å…¨æ€§ã€‚æ¯ä¸ªé˜¶æ®µå®Œæˆåéƒ½éœ€è¦è¿›è¡Œå……åˆ†çš„æµ‹è¯•éªŒè¯ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ã€‚

é‡æ„å®Œæˆåï¼Œé¡¹ç›®å°†å…·å¤‡æ›´å¥½çš„æ‰©å±•æ€§ã€æ›´é«˜çš„æ€§èƒ½å’Œæ›´æ¸…æ™°çš„æ¶æ„ï¼Œä¸ºåç»­çš„åŠŸèƒ½å¼€å‘å’Œç»´æŠ¤å¥ å®šåšå®åŸºç¡€ã€‚